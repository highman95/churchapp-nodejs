<h3>R.O.F Control Analysis</h3>
<hr />

<div class="row d-print-none">
  <div class="col-md-12">
    <form method="get" action="">
      <div class="form-row align-items-center">
        <div class="col-auto">
          <label class="mb-2" for="station-box">Station:</label>
          <select
            class="custom-select custom-select-sm mb-2"
            name="station"
            id="station-box"
            required
          >
            <option value="">Choose Station...</option>
            {{#if stations}}
              {{#each stations}}
                <option value={{id}} {{selected ../queryRef.station id}}>
                  {{name}}
                </option>
              {{/each}}
            {{/if}}
          </select>
        </div>

        <div class="col-auto">
          <label class="mb-2" for="month-box">Month:</label>
          <input
            type="month"
            name="monthYear"
            id="month-box"
            class="form-control form-control-sm mb-2"
            min="1930-01"
            max="{{queryRef.max}}"
            value="{{queryRef.current}}"
            required
          />
        </div>

        <div class="col-auto">
          <label>&nbsp;</label>
          <button type="submit" class="btn btn-danger btn-sm mb-2">Show</button>
          <button
            type="button"
            class="btn btn-secondary btn-sm mb-2"
            onclick="window.print()"
            title="Print"
          >
            {{{show-icon "print"}}}
          </button>
        </div>
      </div>
    </form>
  </div>
</div>
<hr class="mb-0 d-print-none" />

<div class="row">
  <div class="col-12">
    <div class="table-responsive-md">
      <table class="table table-striped table-bordered table-sm">
        <thead style="font-size:11px;">
          <tr
            style="background-color:#aaaaaa;line-height:normal;text-transform:uppercase;"
          >
            <th width="20%" rowspan="2" style="background-color:#333;"></th>
            <th>Cummulative B/F</th>
            <th>Actual For the Month</th>
            <th>Cummulative to date</th>
            <th>Budget</th>
            <th>Variance</th>
          </tr>
          <tr
            style="background-color:#cccccc;line-height:normal;text-transform:uppercase;"
          >
            <th>(A)</th>
            <th>(B)</th>
            <th>(A + B)</th>
            <th>(C)</th>
            <th>(B - C)</th>
          </tr>
        </thead>

        <tbody style="font-size: smaller;">
          <tr style="line-height:15px;">
            <td style="font-weight:bold;">Balance b/fwd</td>
            <td align="right">---</td>
            <td
              align="right"
            >{{!<?php echo number_format($balancebfwd,2); ?>}}</td>
            <td align="right">---</td>
            <td align="right">---</td>
            <td
              align="right"
            >{{!<?php echo number_format($balancebfwd,2); ?>}}</td>
          </tr>
          <tr style="background-color:#d8f1fa;line-height:15px;">
            <td style="font-weight:bold;">
              ROF Recieved (i.e. Approved Budget Value)
            </td>
            <td align="right">
              {{!<?php echo ($cummulativeROFbf == 0)   ? '---' : number_format($cummulativeROFbf,2); ?>}}
            </td>
            <td align="right">
              {{!<?php echo ($currentmonthROF  == 0)   ? '---' : number_format($currentmonthROF,2); ?>}}
            </td>
            <td align="right">
              {{!<?php echo ($cummulativeROF   == 0)   ? '---' : number_format($cummulativeROF,2); ?>}}
            </td>
            <td align="right">
              {{!<?php echo ($currentmonthbudget == 0) ? '---' : number_format($currentmonthbudget,2); ?>}}
            </td>
            <td align="right">
              {{!<?php echo ($currentmonthROF  == 0)   ? '---' : number_format($currentmonthROF,2); ?>}}
            </td>
          </tr>
          <tr style="line-height:15px;">
            <td style="font-weight:bold;">
              GRANT RECEIVED (i.e. Others-Specify) NOT PROJECT GRANT
            </td>
            <td align="right">---</td>
            <td align="right">---</td>
            <td align="right">---</td>
            <td align="right">---</td>
            <td align="right">---</td>
          </tr>
          <tr style="background-color:#d8f1fa;line-height:15px;">
            <td style="font-weight:bold;">TOTAL INFLOW (A)</td>
            <td align="right">
              {{!<?php echo ($cummulativeROFbf == 0)   ? '---' : number_format($cummulativeROFbf,2); ?>}}
            </td>
            <td align="right">
              {{!<?php echo number_format(($balancebfwd + $currentmonthROF),2); ?>}}
            </td>
            <td align="right">
              {{!<?php echo number_format(($balancebfwd + $cummulativeROF),2); ?>}}
            </td>
            <td align="right">
              {{!<?php echo ($currentmonthbudget == 0) ? '---' : number_format($currentmonthbudget,2); ?>}}
            </td>
            <td align="right">
              {{!<?php echo number_format(($balancebfwd + $currentmonthROF),2); ?>}}
            </td>
          </tr>
          <tr><td colspan="6">&nbsp;</td></tr>

          <tr style="font-weight:bold;line-height:15px;">
            <td style="background-color:#333;color:white">EXPENDITURE</td>
            <td style="background-color:#aaa;" colspan="5"></td>
          </tr>
          <tr><td colspan="6" style="background-color:#aaa"></td></tr>

          {{! <?php $budgetitems = Church::get_budget_items(); ?> }}

          {{! <?php if(count($budgetitems)){ ?> }}
          {{! <?php foreach($budgetitems as $cnt => $item){ ?> }}
          {{! <?php $bgxcolor = Util::set_background_color($cnt,2); ?> }}

          {{! <?php $itemId = $item['btid']; ?> }}
          {{! <?php $itemcummulativespendbf = Church::get_item_cummulative_expenditure($churchId,$itemId,$servicemonth,$serviceyear); ?> }}
          {{! <?php $itemmonthlytotalspend  = Church::get_item_total_monthly_expenditure($churchId,$itemId,$servicemonth,$serviceyear); ?> }}
          {{! <?php $itemmonthlytotalbudget = Church::get_item_budget_estimate($churchId,$itemId,$servicemonth,$serviceyear); ?> }}
          {{! <?php $itemcummulativespendtd = ($itemcummulativespendbf + $itemmonthlytotalspend); ?> }}
          {{! <?php #$itemtotalvariance     = ($itemmonthlytotalspend - $itemmonthlytotalbudget);  ?> }}

          <tr style="line-height:15px;">
            <th
              align="left"
            >{{!<?php  echo $item['budget_item_label']; ?>}}</th>
            <td
              align="right"
            >{{!<?php echo ($itemcummulativespendbf == '') ? '---' : number_format($itemcummulativespendbf,2); ?>}}</td>
            <td
              align="right"
            >{{!<?php echo ($itemmonthlytotalspend  == '') ? '---' : number_format($itemmonthlytotalspend,2); ?>}}</td>
            <td
              align="right"
            >{{!<?php echo ($itemcummulativespendtd == 0)  ? '---' : number_format($itemcummulativespendtd,2); ?>}}</td>
            <td
              align="right"
            >{{!<?php echo ($itemmonthlytotalbudget == 0)  ? '---' : number_format($itemmonthlytotalbudget,2); ?>}}</td>
            <td
              align="right"
            >{{!<?php echo ($itemmonthlytotalbudget == 0)  ? '---' : number_format($itemmonthlytotalbudget,2); ?>}}</td>
          </tr>

          {{! <?php $t_itemcummulativespendbf += $itemcummulativespendbf; ?> }}
          {{! <?php $t_itemmonthlytotalspend  += $itemmonthlytotalspend; ?> }}
          {{! <?php $t_itemmonthlytotalbudget += $itemmonthlytotalbudget; ?> }}
          {{! <?php $t_itemcummulativespendtd += $itemcummulativespendtd; ?> }}
          {{! <?php #$itemtotalvariance     = ($itemmonthlytotalspend - $itemmonthlytotalbudget);  ?> }}

          {{! <?php } ?> }}
          {{! <?php } ?> }}
        </tbody>

        <tfoot style="font-size: smaller;">
          <tr style="background-color:ivory;font-weight:bold;line-height:15px;">
            <td>TOTAL EXPENDITURE (B)</td>
            <td align="right">
              {{!<?php echo ($t_itemcummulativespendbf == 0) ? '---' : number_format($t_itemcummulativespendbf,2); ?>}}
            </td>
            <td align="right">
              {{!<?php echo ($t_itemmonthlytotalspend == 0)  ? '---' : number_format($t_itemmonthlytotalspend,2); ?>}}
            </td>
            <td align="right">
              {{!<?php echo ($t_itemcummulativespendtd == 0) ? '---' : number_format($t_itemcummulativespendtd,2); ?>}}
            </td>
            <td align="right">
              {{!<?php echo ($t_itemmonthlytotalbudget == 0) ? '---' : number_format($t_itemmonthlytotalbudget,2); ?>}}
            </td>
            <td align="right">
              {{!<?php echo ($t_itemmonthlytotalbudget == 0) ? '---' : number_format($t_itemmonthlytotalbudget,2); ?>}}
            </td>
          </tr>
          <tr style="background-color:#aaa;font-weight:bold;line-height:15px;">
            <td>Balance c/d (A-B)</td>
            <td align="right">---</td>
            <td align="right">
              {{!<?php echo number_format(($balancebfwd + $currentmonthROF),2); ?>}}
            </td>
            <td align="right">---</td>
            <td align="right">---</td>
            <td align="right"></td>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>
</div>
